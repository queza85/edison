/***************************************/
/* 전역변수 */
/***************************************/
var API_URL = "http://150.183.247.210:8080/majin/api";


/***************************************/
/* AJAX 통신에러 처리 */
/***************************************/
function ajaxError(request, type, errorThrown) {
	var message = "AJAX 통신에서 에러가 발생 했습니다.\n";
	switch (type) {
		case 'timeout':
			message += "요청 시간을 초과 하였습니다.";
			break;
		case 'notmodified':
			message += "요청이 변경되지 않았습니다.";
			break;
		case 'parsererror':
			message += "XML/Json에 맞지 않습니다.";
			break;
		default:
			message += "HTTP 통신에러 (" + request.status + " : " + request.statusText + " : "  + request.responseText + ").";
	}
	message += "\n";
	alert(message);
}

/***************************************/
/* 로그인 처리 */
/***************************************/
function login(id, pw){
	 var str_xml = '<?xml version="1.0" encoding="utf-8"?>'
         			+ '<login>'
         			+ '<userId>' + id + '</userId>'
         			+ '<password>' + pw + '</password>'
         			+ '</login>';

	$.ajax({
		url: API_URL + "/user/login",
	    type: "POST",
	    cache:false,
	    async:false,
	    timeout : 30000, 
	    contentType:"application/xml; charset=UTF-8",
	    dataType:"json",
	    data: str_xml
	}).done(function(data, status, xhr) {
		// 통신성공
		var _token = getTokenFromData(data);
		//$("#content").html(_token);
	    saveToken(_token);	
	}).fail(function(xhr, status, error) {
		// 통신실패
		ajaxError(xhr, status, error);
	}).always(function(arg1, status, arg2) {
	});
}

/***************************************/
/* 사용자 리스트 처리 */
/***************************************/
function getUserList() {
	if(isLogin()){
			   $.ajax({
				     
				   	  url: API_URL + "/user/list",
				      headers: {          
				          "Accept" : "application/json",         
				          "Content-Type" : "application/xml",
						  "Access-Control-Allow-Credentials" : "true",
				          "Authorization" : "Basic " + localStorage.getItem('Token') 
				      },				      	
				       type: "GET", 
				       contentType:"application/xml; charset=UTF-8",
				       dataType:"json"
				    	   
				   }).done(function(data, status, xhr) {
				      // 통신성공
				      alert("성공");
				   }).fail(function(xhr, status, error) {
				      // 통신실패
				      alert("실패");
				      ajaxError(xhr, status, error);
				   }).always(function(arg1, status, arg2) {
				      // 통신완료
				      alert("완료");
				   });
			   }
	}

	
/***************************************/
/* 토큰 취득 */
/***************************************/
function getTokenFromData(data) {
	var token = data.split("\n")[0].replace(/s/gi, '').split(": ")[1];
	return token;
}

/***************************************/
/* 토큰 저장 */
/***************************************/
function saveToken(token) {
	localStorage.setItem('Token', token);
}

/***************************************/
/* 토큰 삭제 */
/***************************************/
function deleteToken() {
	// 모든 로그인 정보 삭제
	localStorage.clear();
}

/***************************************/
/* 로그인 유무 체크 */
/* return : true-정상로그인 , false-로그아웃 */
/***************************************/
function isLogin() {
	// 로그인한지 하루 지난 경우 로그아웃으로 처리
	if (localStorage.getItem('Token') !== null) {
		return true;
	} else {
		deleteToken();
		return false;
	}
}

/***************************************/
/* 유저정보 확인 */
/***************************************/
function getUserInfo(data){
	for(var i = 0; i <data.count; i++){
		data.users[i].id;
		data.users[i].userid;
		data.users[i].getItem(user);
	}
}
